<!DOCTYPE html>
<html>

<head>
    <title>edit</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/edit.css">
</head>

<body>
    <div class="main">
        <div class="dish" id="dish"></div>
    </div>

    <script>
        async function loadDish() {
            const urlParams = new URLSearchParams(window.location.search);
            const category = urlParams.get("category");
            const container = document.getElementById("dish");
            container.innerHTML = `
                <form id="editForm">
                    <input class="text" type="file" accept="image/*" name="image" id="image"> 
                    <input class="text" type="text" name="name" id="name" value="Название">
                    <input class="text" type="text" name="category" id="category" value="${category}">
                    <textarea class="text" name="description" id="description">Описание</textarea>
                    <div class="button_and_price">
                        <input class="text" type="number" name="price" id="price" value="0">
                        <input class="button" type="submit" value="Готово">
                    </div>
                </form> 
            `;

            const form = document.getElementById('editForm');
            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const formData = new FormData();
                formData.append('name', document.getElementById('name').value);
                formData.append('category', document.getElementById('category').value);
                formData.append('description', document.getElementById('description').value);
                formData.append('price', document.getElementById('price').value);

                const fileInput = document.getElementById('image');
                if (fileInput.files.length > 0) {
                    formData.append('image', fileInput.files[0]);
                }

                const response = await fetch('/api/v1/menu/add_dish', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    alert('Блюдо добавлено!');
                    window.location.href = 'admin.html';
                } else {
                    alert('Ошибка при добавлении');
                }
            });
        }

        document.addEventListener("DOMContentLoaded", loadDish);
    </script>
</body>

</html>